unit uPrincipal;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Buttons, Vcl.ExtCtrls,
  uCalculadoraController;

type
  TFrmCalculadora = class(TForm)
    pnlDisplay: TPanel;
    pnlComandos: TPanel;
    pnlBotoes: TPanel;
    pnlOperacoes: TPanel;
    bbtnSete: TBitBtn;
    bbtnOito: TBitBtn;
    bbtnNove: TBitBtn;
    bbtnQuatro: TBitBtn;
    bbtnCinco: TBitBtn;
    bbtnSeis: TBitBtn;
    bbtnUm: TBitBtn;
    bbtnDois: TBitBtn;
    bbtnTres: TBitBtn;
    bbtnZero: TBitBtn;
    edtDisplay: TEdit;
    edtHist: TEdit;         // Seu display de histórico
    bbtnIgual: TBitBtn;
    bbtnMult: TBitBtn;
    bbtnDivi: TBitBtn;
    bbtnMenos: TBitBtn;
    bbtnMais: TBitBtn;

    // Eventos do Form
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);

    // Eventos Compartilhados (Você vai ligar estes eventos nos botões)
    procedure NumeroClick(Sender: TObject);
    procedure OperacaoClick(Sender: TObject);
    procedure IgualClick(Sender: TObject);

  private
    { Private declarations }
    FController: TCalculadoraController; // Sua variável da Controller
    procedure AtualizarDisplay;
  public
    { Public declarations }
  end;

var
  FrmCalculadora: TFrmCalculadora;

implementation

// Não esqueça de dar uses no Model se precisar criar ele aqui
uses uCalculadoraModel;

{$R *.dfm}

{ TFrmCalculadora }

procedure TFrmCalculadora.FormCreate(Sender: TObject);
begin
  // Instancia a Controller passando o Model
  FController := TCalculadoraController.Create(TCalculadoraModel.Create);
end;

procedure TFrmCalculadora.FormDestroy(Sender: TObject);
begin
  FController.Free;
end;

// --- LÓGICA DOS NÚMEROS ---
// Selecione TODOS os botões de número (bbtnZero..bbtnNove)
// No Object Inspector > Events > OnClick, escolha "NumeroClick"
procedure TFrmCalculadora.NumeroClick(Sender: TObject);
begin
  // A Tag guarda o valor do botão (0 a 9)
  FController.AdicionarNumero((Sender as TBitBtn).Tag);
  AtualizarDisplay;
end;

// --- LÓGICA DAS OPERAÇÕES ---
// Selecione bbtnMais, bbtnMenos, bbtnMult, bbtnDivi
// No Object Inspector > Events > OnClick, escolha "OperacaoClick"
procedure TFrmCalculadora.OperacaoClick(Sender: TObject);
var
  OperacaoEscolhida: TOperacao;
  SimboloOperacao: String;
begin
  SimboloOperacao := '';
  OperacaoEscolhida := opNenhuma;

  // Descobre qual botão foi clicado
  if Sender = bbtnMais then
  begin
    OperacaoEscolhida := opSoma;
    SimboloOperacao := '+';
  end
  else if Sender = bbtnMenos then
  begin
    OperacaoEscolhida := opSubtracao;
    SimboloOperacao := '-';
  end
  else if Sender = bbtnMult then
  begin
    OperacaoEscolhida := opMultiplicacao;
    SimboloOperacao := '*';
  end
  else if Sender = bbtnDivi then
  begin
    OperacaoEscolhida := opDivisao;
    SimboloOperacao := '/';
  end;

  if OperacaoEscolhida <> opNenhuma then
  begin
    // Passa para a Controller
    FController.DefinirOperacao(OperacaoEscolhida);

    // Atualiza o Histórico (edtHist) para mostrar ex: "10 +"
    edtHist.Text := edtDisplay.Text + ' ' + SimboloOperacao;
  end;
end;

// --- LÓGICA DO IGUAL ---
// Ligue no OnClick do bbtnIgual
procedure TFrmCalculadora.IgualClick(Sender: TObject);
begin
  // Atualiza o histórico antes de mudar o resultado: "10 + 5 ="
  edtHist.Text := edtHist.Text + ' ' + edtDisplay.Text + ' =';

  // Manda calcular
  FController.Calcular;

  // Mostra o resultado final
  AtualizarDisplay;
end;

procedure TFrmCalculadora.AtualizarDisplay;
begin
  // Pega o texto atualizado da memória da Controller
  edtDisplay.Text := FController.DisplayText;
end;

end.
